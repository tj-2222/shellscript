# 目次

- [目次](#目次)
- [サマリ](#サマリ)
- [概要](#概要)
- [詳細](#詳細)
  - [サンプル](#サンプル)
  - [フォーマット整理](#フォーマット整理)
    - [`![[image.png]]`](#imagepng)
    - [`![image.png](path/to/image.png)`](#imagepngpathtoimagepng)
- [余談](#余談)


# サマリ

以下の正規表現を使ってparseする

1. `!\[\[.+?\]\]` // obsidian形式
   1. 1行に1つのみ
2. `!\[.+?\]\(.+?\)` // 一般的なmarkdown形式
   1. 1行に2つ並ぶパターンがある

本当はとりうるパターンを洗い出して、テスト範囲を策定した方がいいけど一旦雑にやる。

# 概要

単体テスト用のテストデータを作成する。
とりあえずparse対象となる画像埋め込み文字列のフォーマットを整理する。

# 詳細

## サンプル

既存markdownファイルを眺めたところ、以下の二種類ある

```markdown
![[請求書作成-20240509020601097.webp|#left|536]] <- image converterプラグインで挿入したやつ
![image.png](01_転職先が決まる/_resources/image-5.png) <- evernoteから移行してきたやつ
```

## フォーマット整理

2つのサンプルについて

### `![[image.png]]`

参考： https://publish.obsidian.md/help-ja/%E3%82%AC%E3%82%A4%E3%83%89/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80

obsidian形式。
一般的なmarkdownの表記ではない模様？

正規表現で表すと `!\[\[.+?\]\]`かな...

以下chatgptによるレビュー
参考： https://chatgpt.com/c/b3a0ab28-511d-4a8d-96ca-d5e45c039d32
```
Markdownファイルから画像フォーマットの文を抽出する際に、!\[\[.+\]\]という正規表現を使用すると、いくつかの問題が発生する可能性があります。以下に主な問題点を挙げます：

貪欲なマッチング（Greedy Matching）:
.+ は「貪欲な」量指定子で、できるだけ多くの文字にマッチしようとします。これにより、複数の画像埋め込みが同一行に存在する場合、最初の ![ から最後の ]] までを一つのマッチとして取り扱ってしまう可能性があります。例えば、![[image1.png]] some text ![[image2.png]] という行がある場合、全体が一つのマッチとして抽出されてしまいます。

特定のフォーマットにのみマッチ:
!\[\[.+\]\] は Obsidian や特定のZettelkastenツールで使われるフォーマットには適していますが、標準的なMarkdownの画像埋め込みフォーマット（例: ![代替テキスト](URL "タイトル")）にはマッチしません。そのため、異なるタイプのMarkdown画像埋め込みに対応するためには、別の正規表現が必要です。

改行による影響:
正規表現の .+ は通常、改行を含まないため、複数行に渡る画像の埋め込み（非常に珍しいケースですが）には対応できません。![[image.png]] 形式が複数行にわたる場合があるならば、この点も考慮する必要があります。

これらの問題に対処するためには、正規表現を調整することが必要です。たとえば、貪欲なマッチングを避けるために + の代わりに +?（非貪欲な量指定子）を使用することが考えられます。また、異なるフォーマットに対応するためには複数の正規表現を組み合わせるか、より複雑なパターンを検討する必要があります。
```

つまり`!\[\[.+?\]\]`だとよさげ。

### `![image.png](path/to/image.png)`

一般的なmarkdown形式。

上記に倣って `!\[.+?\]\(.+?\)`でparseしてみる。

# 余談

今メインで使ってるimage埋め込み形式がobsidian形式で、一般的なmarkdownビューワーで動かない。
折角、次の移行が楽だと思ってmarkdownに近しいeditor選んだのにこれだと意味がない。。。

まあ追々考える。

2024/05/26追記

obsidian形式と言うよりweblink形式というらしい。
obsidianの設定でmarkdownのimage埋め込み形式にも出来るので、特に問題は無し。